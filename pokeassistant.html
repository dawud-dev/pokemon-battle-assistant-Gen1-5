<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokémon Battle Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: white;
    margin: 0;
}

.container {
    max-width: 900px;
    margin: 50px auto;
    background: #1e293b;
    padding: 35px;
    border-radius: 20px;
    box-shadow: 0 0 50px rgba(0,0,0,0.6);
}

h1 { text-align:center; }

input, select, button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 10px;
    border: none;
    font-size: 16px;
}

input { background:#0f172a; color:white; }

button {
    background:#3b82f6;
    color:white;
    font-weight:600;
    cursor:pointer;
}

button:hover { background:#2563eb; }

.search-results {
    background:#0f172a;
    border-radius:10px;
    max-height:200px;
    overflow-y:auto;
}

.search-item {
    padding:10px;
    cursor:pointer;
}

.search-item:hover { background:#334155; }

.overlay {
    margin-top:25px;
    background:#0f172a;
    padding:20px;
    border-radius:16px;
    display:flex;
    gap:20px;
    align-items:center;
}

.overlay img {
    width:120px;
    image-rendering: pixelated;
}

.results {
    margin-top:20px;
    background:#0f172a;
    padding:20px;
    border-radius:14px;
}

.result-item {
    padding:10px;
    margin:6px 0;
    border-radius:10px;
    background:#334155;
}

.best {
    background:#16a34a !important;
    font-weight:bold;
}

.stat-highlight {
    font-weight:600;
}

.footer {
    text-align:center;
    margin-top:30px;
    opacity:0.6;
}
</style>
</head>
<body>

<div class="container">

<h1>Pokémon Battle Assistant (Gen 1–5)</h1>

<h3>Move Types:</h3>
<div id="move-selects"></div>
<button onclick="addMove()">+ Add Move</button>

<h3>Opponent Pokémon:</h3>
<input type="text" id="pokemonSearch" placeholder="Search Pokémon...">
<div class="search-results" id="searchResults"></div>

<button onclick="calculate()">Calculate</button>

<div id="pokemonInfo"></div>
<div class="results" id="results"></div>

<div class="footer">
National Dex #1–649 • Data via PokéAPI
</div>

</div>

<script>
const types = [
"normal","fire","water","electric","grass","ice","fighting","poison",
"ground","flying","psychic","bug","rock","ghost","dragon","dark","steel"
];

let pokemonList = [];
let selectedPokemon = null;
let typeCache = {};

async function loadPokemon() {
    const res = await fetch("https://pokeapi.co/api/v2/pokemon?limit=649");
    const data = await res.json();
    pokemonList = data.results;
}

function addMove() {
    const container = document.getElementById("move-selects");
    if(container.children.length >= 4) return;
    const select = document.createElement("select");
    types.forEach(type => {
        select.add(new Option(type.charAt(0).toUpperCase()+type.slice(1), type));
    });
    container.appendChild(select);
}

document.getElementById("pokemonSearch").addEventListener("input", function() {
    const query = this.value.toLowerCase();
    const box = document.getElementById("searchResults");
    box.innerHTML="";
    if(query.length===0) return;

    pokemonList
        .filter(p=>p.name.startsWith(query))
        .slice(0,8)
        .forEach(p=>{
            const div=document.createElement("div");
            div.className="search-item";
            div.textContent=p.name.charAt(0).toUpperCase()+p.name.slice(1);
            div.onclick=()=>selectPokemon(p);
            box.appendChild(div);
        });
});

async function selectPokemon(pokemon) {
    const res = await fetch(pokemon.url);
    selectedPokemon = await res.json();
    document.getElementById("pokemonSearch").value =
        pokemon.name.charAt(0).toUpperCase()+pokemon.name.slice(1);
    document.getElementById("searchResults").innerHTML="";
    displayPokemonInfo();
}

function calculateBST(stats){
    return stats.reduce((sum,s)=>sum+s.base_stat,0);
}

function getStrengthCategory(bst){
    if(bst<400) return "Weak";
    if(bst<500) return "Average";
    if(bst<580) return "Strong";
    if(bst<=600) return "Very Strong";
    return "Extremely Strong / Legendary";
}

function displayPokemonInfo(){
    const typesText = selectedPokemon.types
        .map(t=>t.type.name.charAt(0).toUpperCase()+t.type.name.slice(1))
        .join(" / ");

    const defense = selectedPokemon.stats.find(s=>s.stat.name==="defense").base_stat;
    const spDef = selectedPokemon.stats.find(s=>s.stat.name==="special-defense").base_stat;
    const bst = calculateBST(selectedPokemon.stats);

    const strongerDefense = defense>spDef ? "Higher Defense (Physical bulk)" :
                            spDef>defense ? "Higher Special Defense (Special bulk)" :
                            "Equal Defense and Special Defense";

    document.getElementById("pokemonInfo").innerHTML=`
    <div class="overlay">
        <img src="${selectedPokemon.sprites.front_default}">
        <div>
            <div><strong>Type:</strong> ${typesText}</div>
            <div><strong>Defense:</strong> ${defense}</div>
            <div><strong>Special Defense:</strong> ${spDef}</div>
            <div class="stat-highlight">${strongerDefense}</div>
            <div><strong>Base Stat Total (BST):</strong> ${bst}</div>
            <div><strong>Power Tier:</strong> ${getStrengthCategory(bst)}</div>
        </div>
    </div>
    `;
}

async function getTypeData(type){
    if(typeCache[type]) return typeCache[type];
    const res = await fetch(`https://pokeapi.co/api/v2/type/${type}`);
    const data = await res.json();
    typeCache[type]=data;
    return data;
}

async function calculate(){
    if(!selectedPokemon) return alert("Please select a Pokémon!");
    const moves=document.querySelectorAll("#move-selects select");
    if(moves.length===0) return alert("Select at least one move!");

    const defenderTypes=selectedPokemon.types.map(t=>t.type.name);
    let best=0;
    const results=[];

    for(const move of moves){
        const moveType=move.value;
        const data=await getTypeData(moveType);
        let mult=1;

        defenderTypes.forEach(def=>{
            if(data.damage_relations.double_damage_to.some(t=>t.name===def)) mult*=2;
            if(data.damage_relations.half_damage_to.some(t=>t.name===def)) mult*=0.5;
            if(data.damage_relations.no_damage_to.some(t=>t.name===def)) mult*=0;
        });

        results.push({type:moveType.charAt(0).toUpperCase()+moveType.slice(1), mult});
        if(mult>best) best=mult;
    }

    let html="";
    results.forEach(r=>{
        html+=`<div class="result-item ${r.mult===best && best>1?"best":""}">
        ${r.type} → ${r.mult}x
        </div>`;
    });

    document.getElementById("results").innerHTML=html;
}

loadPokemon();
addMove();
</script>

</body>
</html>